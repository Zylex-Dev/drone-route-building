# Планировщик Маршрута Полёта Дрона

## Начало работы

Следуйте этим шагам, чтобы запустить проект "Планировщик маршрутов для дронов" локально с использованием **Docker**:

### Необходимые условия
- Убедитесь, что на вашем компьютере установлен [Docker](https://www.docker.com/)).

### Запуск проекта
1. Перейдите в корневую директорию проекта.
2. Выполните следующую команду для сборки и запуска контейнеров:
      ```bash 
      docker compose up
      ```
3. После запуска контейнеров откройте веб-браузер и перейдите по адресу:
    ```
    http://localhost:80
    ```

## Обзор проекта

**Планировщик Маршрута Полёта Дрона** — это веб-приложение, предназначенное для автоматического формирования оптимизированного маршрута полёта дрона на основе параметров, задаваемых пользователем. Проект ориентирован на проведение аэрофотосъёмки: он обеспечивает покрытие выбранной пользователем территории (например, область Коломны) с требуемым перекрытием кадров. Для этого используется алгоритм, напоминающий способ «газонокосилки» (бустрофедон), который рассчитывает оптимальный путь по заданной области.


## Функциональные возможности

- **Интерактивный интерфейс карты:**  
  - Отображение карты Коломны с использованием OpenStreetMap и библиотеки Leaflet.
  - Инструменты рисования (с помощью Leaflet.draw) для определения зоны съёмки.

- **Ввод и валидация параметров:**  
  - Пользователь задаёт основные параметры: высоту полёта и желаемое перекрытие изображений.
  - Встроенная проверка корректности ввода предотвращает использование недопустимых значений (например, отрицательных, слишком больших или значение перекрытия, равное 100%, что приводит к нулевому шагу между полосами).

- **Автоматическая генерация маршрута:**  
  - Применяется геопространственный алгоритм «газонокосилки» для создания маршрута, полностью покрывающего выбранную территорию.
  - Алгоритм рассчитывает эффективный шаг между полосами съёмки с учётом технических характеристик камеры и высоты полёта.
  
- **Отображение технической информации:**  
  - После построения маршрута в панели отображаются параметры съёмки: горизонтальный угол обзора, земная ширина кадра, эффективный шаг между полосами и другие.
  - На карте визуально выделяются начальная (зелёным) и конечная (красным) точки маршрута.

- **Удобное управление:**  
  - Кнопка «Удалить всё» позволяет очистить карту от всех нарисованных объектов и маршрута для начала нового планирования.

## Используемые технологии

### Фронтенд

- **HTML, CSS и JavaScript:**  
  Основные технологии для создания структуры, оформления и функциональности веб-страницы.

- **[Bootstrap](https://getbootstrap.com/):**  
  Для создания современного, адаптивного и удобного интерфейса.

- **[Leaflet](https://leafletjs.com/):**  
  Для отображения интерактивных карт и работы с тайлами OpenStreetMap.

- **[Leaflet.draw](https://leaflet.github.io/Leaflet.draw/):**  
  Для добавления инструментов рисования на карту.

### Бэкенд

- **[Node.js](https://nodejs.org/)** и **[Express](https://expressjs.com/):**  
  Лёгкий сервер для обработки запросов и расчёта маршрута.

- **[body-parser](https://www.npmjs.com/package/body-parser):**  
  Для парсинга входящих JSON-запросов.

- **[CORS](https://www.npmjs.com/package/cors):**  
  Для обеспечения кросс-доменных запросов между клиентом и сервером.

- **[Turf.js](https://turfjs.org/):**  
  Библиотека для геопространственных вычислений, включающая функции пересечения, вычисления ограничивающих прямоугольников и генерации линий.

## Математическая основа

Построение маршрута основано на следующих математических концепциях:

### 1. Расчёт угла обзора камеры

**Исходные данные:**
- Фокусное расстояние \( f \) (в мм)
- Ширина матрицы \( w \) (в мм)

**Горизонтальный угол обзора (в радианах):**

$$
\text{FOV} = 2 \cdot \arctan\left(\frac{w}{2f}\right)
$$

### 2. Расчёт земной ширины кадра

При заданной высоте полёта \( h \) (в метрах) ширина области, охватываемой камерой, рассчитывается по формуле:

$$
\text{Земная ширина} = 2 \cdot h \cdot \tan\left(\frac{\text{FOV}}{2}\right)
$$

### 3. Эффективный шаг между полосами

- **Желаемое перекрытие:**  
  Пользователь задаёт процент перекрытия (например, 30% → \( 0.3 \)).

- **Эффективный шаг (в метрах):**

$$
\text{Шаг (м)} = \text{Земная ширина} \times (1 - \text{Перекрытие})
$$

- **Преобразование в градусы:**  
  Приблизительно 1° широты равен 111320 м, поэтому шаг в градусах:

$$
\text{Шаг (°)} = \frac{\text{Шаг (м)}}{111320}
$$

### 4. Алгоритм построения маршрута ("газонокосилка")

- **Шаг 1:** Вычисление ограничивающего прямоугольника (bounding box) для пользовательского полигона.

- **Шаг 2:** Генерация вертикальных линий через bounding box с интервалом, равным рассчитанному эффективному шагу (в градусах).

- **Шаг 3:** Определение точек пересечения каждой вертикальной линии с полигонами заданной территории (с использованием Turf.js). Полученные отрезки являются допустимыми путями полёта.

- **Шаг 4:** Сортировка отрезков по оси \( X \) и объединение их в зигзагообразную траекторию, что обеспечивает непрерывность маршрута.

- **Шаг 5:** Маркировка первой и последней точек маршрута как начальной и конечной точек полёта.